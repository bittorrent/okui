sudo: required
deploy:
    provider: s3
    bucket: $DEPLOYMENT_BUCKET
    skip_cleanup: true
    upload_dir: travis-builds
    local_dir: dist
    on:
        branch:
            - master
            - develop
before_deploy:  ./scripts/ci/build-distribution
addons:
    artifacts:
        bucket: $DEPLOYMENT_BUCKET/travis-artifacts
        paths:  $(git ls-files -o analysis dist | tr "\n" ":")

matrix:
    include:

        # Android
        - os: linux
          language: android
          compiler: clang
          env:
              - NDK_VERSION=r10e
              - API_LEVEL=17
          android:
              components: [ android-22, build-tools-23.0.1 ]
          install: ./scripts/ci/install-android-dependencies
          script:  ./scripts/ci/build-android

        # Linux
        - os: linux
          language: cpp
          dist: trusty
          compiler: clang
          install: ./scripts/ci/install-linux-dependencies
          script:  ./scripts/ci/build-linux

        # MacOS
        - os: osx
          language: cpp
          osx_image: xcode8
          env:     XCODE_TARGET=macos
          install: ./scripts/ci/install-xcode-dependencies
          script:  ./scripts/ci/build-macos

        # iPhone
        - os: osx
          language: cpp
          osx_image: xcode8
          env:     XCODE_TARGET=iphoneos
          install: ./scripts/ci/install-xcode-dependencies
          script:  ./scripts/ci/build-iphoneos

        # AppleTV
        - os: osx
          language: cpp
          osx_image: xcode8
          env:     XCODE_TARGET=appletvos
          install: ./scripts/ci/install-xcode-dependencies
          script:  ./scripts/ci/build-appletvos
